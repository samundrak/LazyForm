var Constant = {
    error: {
        noTemplate: 'No template found, Please enter common template or particular template for input',
        noFormOptions: 'Form options must be set, to set form options you can call setFormOptions method',
        noFormAttr: 'No Form attributes has been provided',
        noFormContainer: 'Container for form has not been set'
    }
};

Array.prototype.insert = function (index, item) {
    this.splice(index, 0, item);
};
var Form = (function () {
    function Form() {
        var _this = this;
        this.$validator = {};
        this.$replaceString = "$input";
        this.$submitCallback = undefined;
        this.$name = undefined;
        this.$inputFieldsName = [];
        this.getForm = function () { return _this.$form; };
        this.getRawHTML = function () { return _this.$container.innerHTML; };
        this.$callback = undefined;
    }
    Form.prototype.setFormOptions = function (options) {
        this.$formOptions = options;
    };
    Form.prototype.setInputValue = function (key, value) {
        if (this.$inputFieldsName.indexOf(key) === -1)
            return;
        document.forms[this.$name][key].value = value;
    };
    Form.prototype.getInputValue = function (key) {
        if (this.$inputFieldsName.indexOf(key) === -1) {
            console.warn("This key(" + key + ") is not available");
            return;
        }
        return document.forms[this.$name][key].value;
    };
    Form.prototype.getAllInputDom = function () {
        var _this = this;
        var allInputValues = [];
        this.$inputFieldsName.forEach(function (item) {
            allInputValues.push(document.forms[_this.$name][item]);
        });
        return allInputValues;
    };
    Form.prototype.getInputDom = function (key) {
        if (this.$inputFieldsName.indexOf(key) === -1) {
            console.warn("This key(" + key + ") is not available");
            return;
        }
        return document.forms[this.$name][key];
    };
    Form.prototype.getAllInputValue = function () {
        var _this = this;
        var allInputValues = {};
        this.$inputFieldsName.forEach(function (item) {
            allInputValues[item] = document.forms[_this.$name][item].value;
        });
        return allInputValues;
    };
    Form.prototype.getContainer = function () {
        return this.$container;
    };
    Form.prototype.create = function (fields) {
        var _this = this;
        if (!this.$formOptions) {
            console.warn(Constant.error.noFormOptions);
            return;
        }
        var form = this.buildForm();
        this.placeTheForm(form);
        this.buildChilds();
        this.attachEvents();
        if (!this.$name)
            return console.error(Constant.error.noFormAttr);
        if (!document.forms[this.$name])
            return console.error(Constant.error.noFormContainer);
        document.forms[this.$name].onsubmit = function (event) {
            var inputValues = {};
            for (var key in _this.$validator) {
                inputValues[key] = _this.getInputValue(key);
            }
            var isFormPassedValidation = false;
            for (var key in inputValues) {
                isFormPassedValidation = _this.validationWatcher({
                    emitter: key,
                    value: inputValues[key],
                    event: event
                });
            }
            if (!isFormPassedValidation)
                return false;
            if (_this.$formOptions.hasOwnProperty('attribute')) {
                if (_this.$formOptions.attribute.hasOwnProperty('onsubmit') || _this.$formOptions.attribute.hasOwnProperty('onSubmit')) {
                    eval(_this.$formOptions.attribute['onsubmit'] || _this.$formOptions.attribute['onSubmit']);
                }
            }
            return true;
        };
    };
    Form.prototype.getValue = function (name) {
        console.log();
    };
    Form.prototype.placeTheForm = function (form) {
        if (!this.$formOptions.hasOwnProperty('container'))
            return;
        var container = this.$formOptions.container;
        if (container.startsWith('.')) {
            // console.log('This is class');
            var tagName = document
                .getElementsByClassName(container.substring(1, container.length));
            if (tagName.length) {
                this.$container = tagName;
                tagName[0].appendChild(form);
            }
        }
        else if (container.startsWith('#')) {
            // console.log('This is id');
            this.$container = document.getElementById(container.substring(1, container.length));
            this.$container.appendChild(form);
        }
        else {
            // console.log('this is element');
            var tagName = document.getElementsByTagName(container);
            if (tagName.length) {
                this.$container = tagName;
                tagName[0].appendChild(form);
            }
            ;
        }
    };
    Form.prototype.createFields = function (tagName, item) {
        var input = document.createElement(tagName);
        var template;
        input.setAttribute('type', 'text');
        if (this.$formOptions.fields.hasOwnProperty('common')) {
            if (this.$formOptions.fields.common.attr) {
                for (var key in this.$formOptions.fields.common.attr) {
                    input.setAttribute(key, this.$formOptions.fields.common.attr[key]);
                }
            }
            template = item.attr.hasOwnProperty('template') ? item.attr.template : this.$formOptions.fields.common.hasOwnProperty('template') ? this.$formOptions.fields.common.template : this.$replaceString;
        }
        for (var key in item.attr) {
            if (key === 'name') {
                this.$inputFieldsName.push(item.attr[key]);
            }
            input.setAttribute(key, item.attr[key]);
        }
        return { input: input, template: template };
    };
    Form.prototype.createElements = function (arrayOfElements, customMessage, id) {
        var tempDiv = document.createElement('div');
        if (customMessage) {
            tempDiv.style.display = 'none';
            if (id)
                tempDiv.setAttribute('id', 'errorLabelContainer_' + id);
        }
        arrayOfElements.forEach(function (item) {
            var element = document.createElement(item.element || 'div');
            for (var key in item.attr) {
                element.setAttribute(key, item.attr[key]);
            }
            element.innerHTML = item.value || customMessage || '';
            tempDiv.appendChild(element);
        });
        return tempDiv;
    };
    Form.prototype.buildChilds = function () {
        var _this = this;
        if (!this.$formOptions.hasOwnProperty('fields'))
            return;
        if (!this.$formOptions.fields.hasOwnProperty('fields'))
            return;
        var submitButton;
        var childElements = [];
        var __this = this;
        for (var key in this.$formOptions.fields.fields) {
            // var field = document.createElement("input");
            switch (key) {
                case 'textarea':
                case 'input':
                    this.$formOptions.fields.fields[key].forEach(function (item) {
                        if (Array.isArray(item.attr))
                            return;
                        var tempElement = document.createElement('temp');
                        var field = _this.createFields(key, item);
                        if (item.before)
                            tempElement.appendChild(_this.createElements(item.before));
                        if (!field.template)
                            return console.error(Constant.error.noTemplate);
                        tempElement.appendChild(field.input);
                        if (_this.$formOptions.fields.validationElement) {
                            if (item.attr.type != 'submit' && item.attr.type != 'Submit') {
                                tempElement.appendChild(_this.createElements([_this.$formOptions.fields.validationElement], 'This Field is required', item.attr ? item.attr.name : undefined));
                            }
                            else {
                                field.input.setAttribute('name', 'submit');
                            }
                        }
                        if (item.after)
                            tempElement.appendChild(_this.createElements(item.after));
                        if (item.validation)
                            __this.$validator[item.attr.name] = item.validation;
                        var changedItem = field.template.replace(_this.$replaceString, tempElement.innerHTML);
                        if (item.attr.type == 'submit' || item.attr.type === 'Submit') {
                            submitButton = changedItem;
                        }
                        else {
                            childElements.push({ index: item.rank || -1, data: changedItem });
                        }
                    });
                    break;
                case 'select':
                    this.$formOptions.fields.fields[key].forEach(function (item) {
                        var tempElement = document.createElement('temp');
                        var field = _this.createFields('select', item);
                        item.options.forEach(function (option) {
                            var tempOption = document.createElement('option');
                            for (var key in option.attr) {
                                tempOption.setAttribute(key, option.attr[key]);
                                tempOption.innerHTML = option.text;
                            }
                            field.input.appendChild(tempOption);
                        });
                        if (item.before)
                            tempElement.appendChild(_this.createElements(item.before));
                        if (item.validation)
                            __this.$validator[item.attr.name] = item.validation;
                        tempElement.appendChild(field.input);
                        if (_this.$formOptions.fields.validationElement) {
                            tempElement.appendChild(_this.createElements([_this.$formOptions.fields.validationElement], 'This Field is required', item.attr ? item.attr.name : undefined));
                        }
                        if (item.after)
                            tempElement.appendChild(_this.createElements(item.after));
                        var changedItem = field.template.replace(_this.$replaceString, tempElement.innerHTML);
                        childElements.push({ index: item.rank || -1, data: changedItem });
                    });
                    break;
                case 'checkbox':
                case 'radio':
                    this.$formOptions.fields.fields[key].forEach(function (item) {
                        var radios = [];
                        var masterKey = key;
                        if (item.name) {
                            _this.$inputFieldsName.push(item.name);
                        }
                        var tempRadioButtonHolder = document.createElement('temp');
                        if (item.before)
                            tempRadioButtonHolder.appendChild(_this.createElements(item.before));
                        item.fields.forEach(function (radio) {
                            var tempElement = document.createElement('temp');
                            var field = document.createElement('input');
                            field.setAttribute('type', masterKey);
                            if (item.name)
                                field.setAttribute('name', item.name || '');
                            if (item.class)
                                field.setAttribute('class', item.class);
                            for (var key in radio) {
                                if (key != 'text')
                                    field.setAttribute(key, radio[key]);
                            }
                            // tempElement.appendChild(field);
                            tempRadioButtonHolder.appendChild(field);
                            if (radio.text) {
                                var tempDiv = document.createElement('span');
                                tempDiv.innerHTML = radio.text;
                                tempRadioButtonHolder.appendChild(tempDiv);
                            }
                            else {
                                var tempDiv = document.createElement('span');
                                tempDiv.innerHTML = radio.value;
                                tempRadioButtonHolder.appendChild(tempDiv);
                            }
                            // radios.push(tempElement.innerHTML);
                        });
                        if (_this.$formOptions.fields.validationElement) {
                            tempRadioButtonHolder.appendChild(_this.createElements([_this.$formOptions.fields.validationElement], 'This Field is required', item.attr ? item.attr.name : undefined));
                        }
                        if (item.validation)
                            __this.$validator[item.attr.name] = item.validation;
                        if (item.after)
                            tempRadioButtonHolder.appendChild(_this.createElements(item.after));
                        var template = item.template ? item.template : _this.$formOptions.fields.common.hasOwnProperty('template') ? _this.$formOptions.fields.common.template : _this.$replaceString;
                        var changedItem = template.replace(_this.$replaceString, tempRadioButtonHolder.innerHTML);
                        childElements.push({ index: item.rank || -1, data: changedItem });
                    });
                    break;
            }
        }
        var sortedChildElements = Utils.sorter(childElements);
        this.$form.innerHTML = '';
        Utils.reArrange(sortedChildElements).forEach(function (element) {
            _this.$form.innerHTML = _this.$form.innerHTML + element.data;
        });
        this.$form.innerHTML = this.$form.innerHTML + submitButton;
    };
    Form.prototype.buildForm = function () {
        var form = document.createElement("form");
        if (this.$formOptions === undefined)
            return console.error("Form options are not setup");
        if (this.$formOptions.hasOwnProperty('attribute')) {
            if (typeof this.$formOptions.attribute === 'object') {
                this.$name = this.$formOptions.attribute.name || "form_" + Date.now();
                this.$formOptions.attribute['name'] = this.$name;
                this.setAttributes(this.$formOptions.attribute, form);
            }
        }
        this.$form = form;
        return form;
    };
    Form.prototype.setAttributes = function (attr, form) {
        for (var key in attr) {
            form.setAttribute(key, attr[key]);
        }
    };
    Form.prototype.attachListener = function (cb) {
        this.$inputFieldsName.forEach(function (item) { return cb.prototype[item] = new Object(); });
        this.$callback = new cb();
    };
    Form.prototype.observer = function (options) {
        var ignoreKeys = [8, 37, 38, 39, 40, 18, 91, 32, 16, 20, 9, 27];
        if (ignoreKeys.indexOf(options.event.keyCode) === -1) {
            if (this.$callback.__proto__.hasOwnProperty(options.emitter)
                && this.$callback.__proto__[options.emitter].hasOwnProperty(options.eventType)) {
                this.validationWatcher(options);
                this.$callback.__proto__[options.emitter][options.eventType]({
                    input: options.emitter,
                    value: options.value,
                    form: options.form,
                    event: options.event
                });
            }
        }
    };
    Form.prototype.validationWatcher = function (options, validationSchema, inputValue) {
        if (validationSchema === void 0) { validationSchema = undefined; }
        if (inputValue === void 0) { inputValue = undefined; }
        if (this.$validator.hasOwnProperty(options.emitter)) {
            if (!validationSchema) {
                validationSchema = {};
                validationSchema[options.emitter] = this.$validator[options.emitter];
            }
            if (!inputValue) {
                inputValue = {};
                inputValue[options.emitter] = options.value;
            }
            var validation = new Validator(inputValue, validationSchema);
            var errorLabelContainer = document.getElementById("errorLabelContainer_" + options.emitter);
            if (!validation.passes()) {
                errorLabelContainer.style.display = 'block';
                errorLabelContainer.firstChild.innerHTML = validation.first(options.emitter);
                document.forms[this.$name]['submit'].disabled = true;
                return false;
            }
            else {
                errorLabelContainer.style.display = 'none';
                errorLabelContainer.firstChild.innerHTML = '';
                document.forms[this.$name]['submit'].disabled = false;
                return true;
            }
        }
        return true;
    };
    Form.prototype.attachEvents = function () {
        var _this = this;
        var events = ['onkeyup', 'onkeydown', 'onmouseover', 'onmousedown', 'onclick', 'onfocus', 'onmouseenter', 'onmouseleave', 'onmousemove', 'onmousewheel'];
        var __this = this;
        this.$inputFieldsName.forEach(function (item) {
            if (!document.forms[_this.$name])
                return console.warn(Constant.error.noFormAttr);
            document.forms[_this.$name][item]['onblur'] = function (event) {
                _this.validationWatcher({
                    emitter: item,
                    value: document.forms[__this.$name][item].value,
                    event: event
                });
            };
            events.forEach(function (eventType) {
                document.forms[_this.$name][item][eventType] = function (event) {
                    __this.observer({
                        eventType: eventType,
                        emitter: item,
                        form: __this.$name,
                        value: document.forms[__this.$name][item].value,
                        event: event
                    });
                };
            });
        });
    };
    return Form;
}());

var Utils = (function () {
    function Utils() {
    }
    Utils.sorter = function (array) {
        var tempObject = {};
        array.forEach(function (item, index) {
            if (item.index) {
                if (tempObject.hasOwnProperty('index_' + item.index)) {
                    tempObject['index_' + item.index].push({ index: item.index, data: item.data });
                }
                else {
                    tempObject['index_' + item.index] = new Array();
                    tempObject['index_' + item.index].push({ index: item.index, data: item.data });
                }
            }
            else {
                tempObject['index_' + array.length + 1] = new Array();
                tempObject['index_' + array.length + 1].push({ index: item.index, data: item.data });
            }
        });
        return tempObject;
    };
    Utils.reArrange = function (tempObject) {
        var sortedRanked = [];
        for (var key in tempObject) {
            sortedRanked.push(tempObject[key][0].index);
        }
        sortedRanked.sort();
        var sortedElements = [];
        var isUnrankedIndex = false;
        sortedRanked.forEach(function (item) {
            if (item != -1) {
                tempObject['index_' + item].forEach(function (elements) {
                    sortedElements.push(elements);
                });
            }
            else {
                isUnrankedIndex = true;
            }
        });
        if (isUnrankedIndex) {
            tempObject['index_-1'].forEach(function (item) {
                sortedElements.push(item);
            });
        }
        return sortedElements;
    };
    return Utils;
}());

/*! laravel-validator-for-js - v0.5.1 - https://github.com/skaterdav85/validatorjs - 2013-05-23 */(function(){var t={required:"The :attribute field is required.",email:"The :attribute format is invalid.",def:"The :attribute attribute has errors.",min:{numeric:"The :attribute must be at least :min.",string:"The :attribute must be at least :min characters."},max:{numeric:"The :attribute must be less than :max.",string:"The :attribute must be less than :max characters."},size:{numeric:"The :attribute must be :size.",string:"The :attribute must be :size characters."},numeric:"The :attribute must be a number.",url:"The :attribute format is invalid."},e=function(t,e){this.rules=e,this.input=t,this.errors={},this.errorCount=0,this.check()};e.prototype={constructor:e,_createMessage:function(t,e){var r,i;if("string"==typeof t&&"object"==typeof e){r=t;for(i in e)e.hasOwnProperty(i)&&(r=r.replace(":"+i,e[i]))}else r=t.replace(/:attribute/,e);return r},check:function(){var e,r,i,n,s,a,u,o,h,c,f;for(e in this.input)if(this.input.hasOwnProperty(e)&&(r=this.input[e],this.rules.hasOwnProperty(e)))for(i=this.rules[e].split("|"),n=i.length,s=0;n>s;s++)if(a=i[s],f=[],a.indexOf(":")>=0&&(a=a.split(":")),a instanceof Array?(u=a[1],a=a[0],o=this.validate[a](r,u)):(u=null,o=this.validate[a](r)),!o){if(this.errors.hasOwnProperty(e)||(this.errors[e]=[]),t.hasOwnProperty(a))if(c=t[a],"object"==typeof c){switch(typeof r){case"number":c=c.numeric;break;case"string":c=c.string}f.attribute=e,f[a]=u,h=this._createMessage(c,f)}else h=this._createMessage(c,e);else c=t.def,h=this._createMessage(c,e);this.errors[e].push(h),this.errorCount++}},passes:function(){return 0===this.errorCount?!0:!1},fails:function(){return this.errorCount>0?!0:!1},first:function(t){return this.errors.hasOwnProperty(t)?this.errors[t][0]:null},validate:{required:function(t){var e=t.replace(/\s/g,"");return(e+"").length>0?!0:!1},size:function(t,e){return e=parseFloat(e),"number"==typeof t?t===e?!0:!1:t.length===e?!0:!1},min:function(t,e){return"number"==typeof t?t>=e?!0:!1:t.length>=e?!0:!1},max:function(t,e){return"number"==typeof t?e>=t?!0:!1:e>=t.length?!0:!1},email:function(t){var e=/\w+@\w{2,}\.\w{2,}/;return t.match(e)?!0:!1},numeric:function(t){var e=Number(t);return"number"!=typeof e||isNaN(e)||"boolean"==typeof t?!1:!0},url:function(t){var e=/^https?:\/\/\S+/;return t.match(e)}}},e.register=function(e,r,i){this.prototype.validate[e]=r,"string"==typeof i&&(t[e]=i)},"undefined"!=typeof module&&"undefined"!=typeof require?module.exports=e:window.Validator=e})();